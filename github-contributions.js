// Generated by CoffeeScript 1.6.3
var api, contributor, github, promise;

api = require('github');

promise = require('when');

github = new api({
  version: '3.0.0'
});

contributor = function(user) {
  var deferred, fetch, process;
  deferred = promise.defer();
  fetch = function(page, total) {
    return github.repos.getFromUser({
      page: page,
      per_page: 100,
      user: 'eighttrackmind'
    }, function(err, res) {
      if (err) {
        return deferred.reject(new Error(err));
      } else {
        return process(res, total, page);
      }
    });
  };
  process = function(res, total, page) {
    var count;
    count = res.length;
    if (count) {
      total += count;
      deferred.notify(total);
      return fetch(++page, total);
    } else {
      return deferred.resolve(total);
    }
  };
  fetch(1, 0);
  return deferred.promise;
};

contributor('eighttrackmind').then(function(count) {
  return console.log(count);
});

module.exports = contributor;
